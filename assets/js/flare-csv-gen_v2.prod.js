"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],n=!0,r=!1,o=void 0;try{for(var c,i=e[Symbol.iterator]();!(n=(c=i.next()).done)&&(a.push(c.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}var allTransactions=[],csvSort=["Timestamp","Action","Source","Base","Volume","Price","Counter","Fee","FeeCcy","Comment"],csvSortMore=["Timestamp","Method","Source","Base","Volume","Counter","Fee","FeeCcy","hash","gas","gasPrice","gasUsed","priceAverage","FeeJPY","VolumeJPY"],methodId={Claim:"0xb2c12192",AutoClaim:"0x6a761202",BatchDelegate:"0xdc4fcda7",Delegate:"0x026e402b",UndelegateAll:"0xb302f393",SetAutoClaiming:"0xe72dcdbb",EnableDelegationAccount:"0xf0977215",Deposit:"0xd0e30db0",CastVote:"0x56781388",Withdraw:"0x2e1a7d4d",SetClaimExecutors:"0x9119c494",Transfer:"0x",logClaim:"0xddf252ad"},actions=["BUY","SELL","PAY","MINING","SENDFEE","REDUCE","BONUS","LENDING","STAKING","CASH","BORROW","RETURN","LOSS"],flareApi="https://flare-explorer.flare.network/api",bbPriceUrl="https://public.bitbank.cc/flr_jpy/candlestick/1min/",dataTable=document.getElementById("transaction-data"),loading=document.getElementById("loading"),dlbtn=document.getElementById("download"),dlbtnM=document.getElementById("download-more"),getData=function(e){return new Promise(function(t,a){fetch(e).then(function(e){return e.json()}).then(function(e){return t(e)}).catch(function(e){return a(e)})})};function render(){loading.classList.remove("d-none"),getTransaction()}function getTransaction(){for(;dataTable.firstChild;)dataTable.removeChild(dataTable.firstChild);var l=document.getElementById("waddress").value,e="".concat(flareApi,"?module=account&action=txlist&address=").concat(l),t="".concat(flareApi,"?module=account&action=tokentx&address=").concat(l);getData(e).then(function(i){i.result.forEach(function(t){var e="".concat(flareApi,"?module=transaction&action=gettxinfo&txhash=").concat(t.hash);getData(e).then(function(e){t.logs=e.result.logs,t.logs[0]&&t.logs.forEach(function(e){e.topics[0].slice(0,10)==methodId.logClaim&&(t.Volume=division10p18fixed9(hexConvert(e.data)))})})}),getData(t).then(function(e){var t=ttJsonCheck(e),a=i.result,n=t.result,r=[].concat(_toConsumableArray(a),_toConsumableArray(n));r.forEach(function(t){var e=new Date(1e3*t.timeStamp);t.Timestamp=convertToJapanDateTime(e,"YMDHMS"),t.unixtimeSec=e.setSeconds(0),t.ymd=convertToJapanDateTime(t.unixtimeSec,"YMD"),t.Source="flare.network",t.Base="FLR",t.Volume=0,t.Price="",t.Counter="JPY",t.FeeCcy="FLR",t.Comment=t.hash,t.candlesticks={},t.priceAverage=0,t.Fee=division10p18fixed9(t.gasPrice*t.gasUsed),t.Method="Unknown",t.methodId=t.input.slice(0,10);for(var a=0,n=Object.entries(methodId);a<n.length;a++){var r=_slicedToArray(n[a],2),o=r[0],c=r[1];if(t.methodId==c){t.Method=o;break}}switch(t.Method){case"Claim":t.logs[0]&&t.logs.forEach(function(e){e.topics[0].slice(0,10)==methodId.logClaim&&(t.Volume=division10p18fixed9(hexConvert(e.data)))});break;case"AutoClaim":case"Deposit":t.Volume=division10p18fixed9(t.value);break;case"Transfer":t.Volume=division10p18fixed9(t.value),l.toUpperCase()==t.from.toUpperCase()?(t.Volume=-t.Volume,t.Action="PAY"):(t.Action="BONUS",t.Fee=0)}switch(t.Method){case"Claim":case"AutoClaim":t.Action="MINING";break;case"BatchDelegate":case"Delegate":case"UndelegateAll":case"SetAutoClaiming":case"EnableDelegationAccount":case"CastVote":case"Withdraw":case"SetClaimExecutors":t.Action="SENDFEE";break;case"Deposit":t.Action="BONUS"}}),r.sort(function(e,t){return t.blockNumber-e.blockNumber});var o=r.length,c=0;return Promise.all([]).then(function(){r.forEach(function(t){var e="".concat(bbPriceUrl).concat(t.ymd);getData(e).then(function(e){1==e.success?e.data.candlestick[0].ohlcv.forEach(function(e){e[5]==t.unixtimeSec&&(t.candlesticks=e,t.priceAverage=Number(((Number(e[0])+Number(e[1])+Number(e[2])+Number(e[3]))/4).toFixed(9)),c++)}):c++,c==o&&tableRender(allTransactions=r)})})})})})}function ttJsonCheck(e){for(var t=e.result,a=0;a<t.length;a++){t[a].input.slice(0,10)!=methodId.AutoClaim&&(t.splice(a,1),a--)}return e.result=t,e}function tableRender(e){e.forEach(function(a){var e=document.createElement("tr"),t=document.createElement("td");switch(t.innerHTML=a.Method,t.classList.add("text-center"),a.Method){case"BatchDelegate":case"Delegate":t.classList.add("bg-primary"),t.classList.add("text-white");break;case"Claim":case"AutoClaim":t.classList.add("bg-warning");break;case"Deposit":t.classList.add("bg-success"),t.classList.add("text-white");break;default:t.classList.add("bg-light")}var n=document.createElement("td");n.classList.add("text-start"),n.innerHTML=a.Timestamp;var r=document.createElement("td"),o=document.createElement("select");o.classList.add("form-select"),actions.forEach(function(e){var t=document.createElement("option");t.value=e,(t.text=e)==a.Action&&(t.selected=!0),o.appendChild(t)}),o.addEventListener("change",function(){a.Action=this.value}),r.appendChild(o);var c=document.createElement("td");c.classList.add("text-start");var i=document.createElement("span");i.classList.add("material-symbols-outlined"),i.innerHTML="link";var l=document.createElement("a");l.href="https://flare-explorer.flare.network/tx/"+a.hash,l.target="_blank",l.appendChild(i),l.appendChild(document.createTextNode(a.hash)),c.appendChild(l);var s=document.createElement("td");s.innerHTML=a.Volume;var d=document.createElement("td");d.innerHTML=a.Fee;var u=document.createElement("td");u.innerHTML=a.priceAverage;var m=document.createElement("td");a.FeeJPY=(a.Fee*a.priceAverage).toFixed(9),m.innerHTML=a.FeeJPY;var h=document.createElement("td");a.VolumeJPY=(a.Volume*a.priceAverage).toFixed(9),0==a.VolumeJPY&&(a.VolumeJPY=0),h.innerHTML=a.VolumeJPY,e.appendChild(t),e.appendChild(n),e.appendChild(r),e.appendChild(c),e.appendChild(s),e.appendChild(d),e.appendChild(u),e.appendChild(m),e.appendChild(h),dataTable.appendChild(e)}),loading.classList.add("d-none"),dlBtnActive()}function dlBtnActive(){loading.classList.add("d-none"),dlbtnM.classList.remove("btn-secondary"),dlbtnM.classList.add("btn-warning"),dlbtnM.classList.remove("disabled"),dlbtn.classList.remove("btn-secondary"),dlbtn.classList.add("btn-warning"),dlbtn.classList.remove("disabled")}function division10p18fixed9(e){var t=Number((e/1e9).toFixed(9));return Number((t/1e9).toFixed(9))}function convertToJapanDateTime(e,t){var a=new Date(e);"YMDHMS"==t?a.setHours(a.getHours()):"YMD"==t&&a.setHours(a.getHours()-9);var n=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,"0"),o=a.getDate().toString().padStart(2,"0"),c=a.getHours().toString().padStart(2,"0"),i=a.getMinutes().toString().padStart(2,"0"),l=("0"+a.getSeconds()).slice(-2);return"YMDHMS"==t?"".concat(n,"-").concat(r,"-").concat(o," ").concat(c,":").concat(i,":").concat(l):"YMD"==t?"".concat(n).concat(r).concat(o):void 0}function hexConvert(e){return parseInt(e,16)}function csvDownload(e,t){var a=Object.keys(e[0]).join(",")+"\n"+e.map(function(e){return Object.values(e).join(",")}).join("\n"),n=new Blob([a],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download=t,r.click(),r.remove()}function downloadCSVforCT(){var e=JSON.parse(JSON.stringify(allTransactions)),n=[];e.forEach(function(t){var a={};csvSort.forEach(function(e){t.hasOwnProperty(e)&&(a[e]=t[e])}),n.push(a)}),csvDownload(n,"flr-csv-for-cryptact.csv")}function downloadCSVMore(){var e=JSON.parse(JSON.stringify(allTransactions)),n=[];e.forEach(function(t){var a={};csvSortMore.forEach(function(e){t.hasOwnProperty(e)&&(a[e]=t[e])}),n.push(a)}),csvDownload(n,"flr-csv-more.csv")}function old(){}