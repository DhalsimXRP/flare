"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],n=!0,r=!1,c=void 0;try{for(var o,d=e[Symbol.iterator]();!(n=(o=d.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==d.return||d.return()}finally{if(r)throw c}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var allTransactions=[],csvSort=["Timestamp","Action","Source","Base","Volume","Price","Counter","Fee","FeeCcy","Comment","method","gas","gasPrice","gasUsed","priceAverage","FeeJPY","VolumeJPY"],methodId={Claim:"0xb2c12192",BatchDelegate:"0xdc4fcda7",Delegate:"0x026e402b",SetAutoClaiming:"0xe72dcdbb",EnableDelegationAccount:"0xf0977215",Deposit:"0xd0e30db0",CastVote:"0x56781388",Withdraw:"0x2e1a7d4d",SetClaimExecutors:"0x9119c494",Transfer:"0x",logClaim:"0xddf252ad"},actions=["BUY","SELL","PAY","MINING","SENDFEE","REDUCE","BONUS","LENDING","STAKING","CASH","BORROW","RETURN","LOSS"],methodAddress={claim:["0x9edca806834e89cc928ef4951ce0506be8416309","0x85627d71921ae25769f5370e482ada5e1e418d37"],delegate:["0x1d80c49bbbcd1c0911346656b529df9e5c2f783d"]},flareApi="https://flare-explorer.flare.network/api",bbPriceUrl="https://public.bitbank.cc/flr_jpy/candlestick/1min/",dataTable=document.getElementById("transaction-data"),tableData=document.getElementById("transaction-data"),dlbtn=document.getElementById("download"),dlbtnM=document.getElementById("download-more");function render(){for(;tableData.firstChild;)tableData.removeChild(tableData.firstChild);var l=document.getElementById("waddress").value,e="https://flare-explorer.flare.network/api?module=account&action=txlist&address=".concat(l);l&&fetch(e).then(function(e){return e.json()}).then(function(e){allTransactions=e.result;var i=[];return allTransactions.forEach(function(a){a.Source="flare.network",a.Base="FLR",a.Volume=0,a.Price="",a.Counter="JPY",a.FeeCcy="FLR",a.Comment=a.hash,a.candlestick={},a.priceAverage=0,a.wrapped=0,a.Fee=division10p18fixed8(a.gasPrice*a.gasUsed),a.method="Unknown";var e=new Date(1e3*a.timeStamp);a.Timestamp=convertToJapanDateTime(e,"YMDHMS"),a.unixtimeSec=e.setSeconds(0),a.ymd=convertToJapanDateTime(a.unixtimeSec,"YMD"),a.methodId=a.input.slice(0,10);for(var t=0,n=Object.entries(methodId);t<n.length;t++){var r=_slicedToArray(n[t],2),c=r[0],o=r[1];if(a.methodId==o){a.method=c;break}}var d=flareApi+"?module=transaction&action=gettxinfo&txhash=".concat(a.hash);i.push(fetch(d).then(function(e){return e.json()}).then(function(e){switch(a.logs=e.result.logs,a.method){case"Claim":a.logs[0]&&a.logs.forEach(function(e){e.topics[0].slice(0,10)==methodId.logClaim&&(a.Volume=division10p18fixed8(hexConvert(e.data)))});break;case"Deposit":a.wrapped=division10p18fixed8(a.value);break;case"Transfer":a.Volume=division10p18fixed8(a.value),l.toUpperCase()==a.from.toUpperCase()?(a.Volume=-a.Volume,a.Action="PAY"):a.Action="BONUS"}switch(a.method){case"Claim":a.Action="MINING";break;case"BatchDelegate":case"Delegate":case"SetAutoClaiming":case"EnableDelegationAccount":case"Deposit":case"CastVote":case"Withdraw":case"SetClaimExecutors":a.Action="SENDFEE"}var t=bbPriceUrl+a.ymd;return fetch(t).then(function(e){return e.ok?e.json():Promise.resolve({})})}).then(function(e){1==e.success&&e.data.candlestick[0].ohlcv.forEach(function(e){e[5]==a.unixtimeSec&&(a.candlestick=e,a.priceAverage=Number(((Number(e[0])+Number(e[1])+Number(e[2])+Number(e[3]))/4).toFixed(8)))})}))}),Promise.all(i).then(function(){allTransactions.forEach(function(a){var e=document.createElement("tr"),t=document.createElement("td");switch(t.innerHTML=a.method,t.classList.add("text-center"),a.method){case"BatchDelegate":case"Delegate":t.classList.add("bg-primary"),t.classList.add("text-white");break;case"Claim":t.classList.add("bg-warning");break;case"Deposit":t.classList.add("bg-success"),t.classList.add("text-white");break;default:t.classList.add("bg-light")}var n=document.createElement("td");n.classList.add("text-start"),n.innerHTML=a.Timestamp;var r=document.createElement("td"),c=document.createElement("select");c.classList.add("form-select"),actions.forEach(function(e){var t=document.createElement("option");t.value=e,(t.text=e)==a.Action&&(t.selected=!0),c.appendChild(t)}),c.addEventListener("change",function(){a.Action=this.value,downloadCSV(allTransactions)}),r.appendChild(c);var o=document.createElement("td");o.classList.add("text-start");var d=document.createElement("span");d.classList.add("material-symbols-outlined"),d.innerHTML="link";var i=document.createElement("a");i.href="https://flare-explorer.flare.network/tx/"+a.hash,i.target="_blank",i.appendChild(d),i.appendChild(document.createTextNode(a.hash)),o.appendChild(i);var l=document.createElement("td");l.innerHTML=a.wrapped;var s=document.createElement("td");s.innerHTML=a.Volume;var u=document.createElement("td");u.innerHTML=a.Fee;var m=document.createElement("td");m.innerHTML=a.priceAverage;var p=document.createElement("td");a.FeeJPY=(a.Fee*a.priceAverage).toFixed(8),p.innerHTML=a.FeeJPY;var h=document.createElement("td");a.VolumeJPY=(a.Volume*a.priceAverage).toFixed(8),0==a.VolumeJPY&&(a.VolumeJPY=0),h.innerHTML=a.VolumeJPY,e.appendChild(t),e.appendChild(n),e.appendChild(r),e.appendChild(o),e.appendChild(l),e.appendChild(s),e.appendChild(u),e.appendChild(m),e.appendChild(p),e.appendChild(h),dataTable.appendChild(e)}),downloadCSV(allTransactions)})})}function convertToJapanDateTime(e,t){var a=new Date(e);"YMDHMS"==t?a.setHours(a.getHours()):"YMD"==t&&a.setHours(a.getHours()-9);var n=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,"0"),c=a.getDate().toString().padStart(2,"0"),o=a.getHours().toString().padStart(2,"0"),d=a.getMinutes().toString().padStart(2,"0"),i=("0"+a.getSeconds()).slice(-2);return"YMDHMS"==t?"".concat(n,"-").concat(r,"-").concat(c," ").concat(o,":").concat(d,":").concat(i):"YMD"==t?"".concat(n).concat(r).concat(c):void 0}function downloadCSV(e){var n=[],r=[];e.forEach(function(t){delete t.candlestick,delete t.logs,delete t.input,delete t.isError,delete t.nonce,delete t.transactionIndex,delete t.value,delete t.txreceipt_status,delete t.contractAddress,delete t.methodId,delete t.ymd,delete t.hash,delete t.blockHash,delete t.blockNumber,delete t.confirmations,delete t.cumulativeGasUsed,delete t.from,delete t.timeStamp,delete t.to,delete t.unixtimeSec,delete t.wrapped;var a={};csvSort.forEach(function(e){t.hasOwnProperty(e)&&(a[e]=t[e])}),n.push(a),r.push(a)});var a=Object.keys(r[0]),t=a.join(","),c=r.map(function(t){return a.map(function(e){return t[e]}).join(",")}).join("\n"),o="data:text/csv;charset=utf-8,".concat(t,"\n").concat(c),d=encodeURI(o);dlbtnM.href=d,dlbtnM.setAttribute("download","flr-csv.csv"),dlbtnM.classList.remove("btn-secondary"),dlbtnM.classList.add("btn-warning"),dlbtnM.classList.remove("disabled"),n.forEach(function(e){delete e.VolumeJPY,delete e.gas,delete e.gasPrice,delete e.gasUsed,delete e.hash,delete e.method,delete e.priceAverage,delete e.FeeJPY});var i=Object.keys(n[0]),l=i.join(","),s=n.map(function(t){return i.map(function(e){return t[e]}).join(",")}).join("\n"),u="data:text/csv;charset=utf-8,".concat(l,"\n").concat(s),m=encodeURI(u);dlbtn.href=m,dlbtn.setAttribute("download","flr-csv-for-cryptact.csv"),dlbtn.classList.remove("btn-secondary"),dlbtn.classList.add("btn-warning"),dlbtn.classList.remove("disabled")}function division10p18fixed8(e){return Number((e/1e18).toFixed(8))}function hexConvert(e){return parseInt(e,16)}