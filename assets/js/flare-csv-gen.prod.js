"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],n=!0,r=!1,c=void 0;try{for(var i,d=e[Symbol.iterator]();!(n=(i=d.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==d.return||d.return()}finally{if(r)throw c}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var allTransactions=[],csvSort=["ymdhms","method","hash","claim","fee","priceAverage","feeJPY","claimJPY"],methodAddress={claim:["0x9edca806834e89cc928ef4951ce0506be8416309","0x85627d71921ae25769f5370e482ada5e1e418d37"],delegate:["0x1d80c49bbbcd1c0911346656b529df9e5c2f783d"]},flareApi="https://flare-explorer.flare.network/api",bbPriceUrl="https://public.bitbank.cc/flr_jpy/candlestick/1min/",dataTable=document.getElementById("transaction-data"),tableData=document.getElementById("transaction-data"),dlbtn=document.getElementById("download");function render(){for(;tableData.firstChild;)tableData.removeChild(tableData.firstChild);var e=document.getElementById("waddress").value,t="https://flare-explorer.flare.network/api?module=account&action=txlist&address=".concat(e);e&&fetch(t).then(function(e){return e.json()}).then(function(e){allTransactions=e.result;var o=[];return allTransactions.forEach(function(n){n.claim=0,n.candlestick={},n.priceAverage=0,n.fee=division10p18fixed8(n.gasPrice*n.gasUsed);var e=new Date(1e3*n.timeStamp);n.ymdhms=convertToJapanDateTime(e,"YMDHMS"),n.unixtimeSec=e.setSeconds(0),n.ymd=convertToJapanDateTime(n.unixtimeSec,"YMD");for(var t=n.to,a=0,r=Object.entries(methodAddress);a<r.length;a++){var c=_slicedToArray(r[a],2),i=c[0];if(-1!==c[1].indexOf(t)){n.method=i;break}}n.method?"0"!=n.value&&(n.method="deposit"):n.method="other";var d=flareApi+"?module=transaction&action=gettxinfo&txhash=".concat(n.hash);o.push(fetch(d).then(function(e){return e.json()}).then(function(e){var t;n.logs=e.result.logs,"claim"!=n.method||(t=n.logs)[0]&&t.forEach(function(t){var a=t.address;methodAddress.delegate.forEach(function(e){e!==a||(n.claim=division10p18fixed8(hexConvert(t.data)))})});var a=bbPriceUrl+n.ymd;return fetch(a).then(function(e){return e.ok?e.json():Promise.resolve({})})}).then(function(e){1==e.success&&e.data.candlestick[0].ohlcv.forEach(function(e){e[5]==n.unixtimeSec&&(n.candlestick=e,n.priceAverage=Number(((Number(e[0])+Number(e[1])+Number(e[2])+Number(e[3]))/4).toFixed(8)))})}))}),Promise.all(o).then(function(){allTransactions.forEach(function(e){var t=document.createElement("tr"),a=document.createElement("td");switch(a.innerHTML=e.method,a.classList.add("text-center"),e.method){case"delegate":a.classList.add("bg-primary"),a.classList.add("text-white");break;case"claim":a.classList.add("bg-warning");break;default:a.classList.add("bg-light")}var n=document.createElement("td");n.classList.add("text-left"),n.innerHTML=e.ymdhms;var r=document.createElement("td");r.classList.add("text-left");var c=document.createElement("span");c.classList.add("material-symbols-outlined"),c.innerHTML="link";var i=document.createElement("a");i.href="https://flare-explorer.flare.network/tx/"+e.hash,i.target="_blank",i.appendChild(c),i.appendChild(document.createTextNode(e.hash)),r.appendChild(i);var d=document.createElement("td");d.innerHTML=e.claim;var o=document.createElement("td");o.innerHTML=e.fee;var l=document.createElement("td");l.innerHTML=e.priceAverage;var s=document.createElement("td");e.feeJPY=(e.fee*e.priceAverage).toFixed(8),s.innerHTML=e.feeJPY;var m=document.createElement("td");e.claimJPY=(e.claim*e.priceAverage).toFixed(8),0==e.claimJPY&&(e.claimJPY=0),m.innerHTML=e.claimJPY,t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(d),t.appendChild(o),t.appendChild(l),t.appendChild(s),t.appendChild(m),dataTable.appendChild(t)})})}).then(function(){downloadCSV(allTransactions)})}function convertToJapanDateTime(e,t){var a=new Date(e);"YMDHMS"==t?a.setHours(a.getHours()):"YMD"==t&&a.setHours(a.getHours()-9);var n=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,"0"),c=a.getDate().toString().padStart(2,"0"),i=a.getHours().toString().padStart(2,"0"),d=a.getMinutes().toString().padStart(2,"0"),o=("0"+a.getSeconds()).slice(-2);return"YMDHMS"==t?"".concat(n,"-").concat(r,"-").concat(c," ").concat(i,":").concat(d,":").concat(o):"YMD"==t?"".concat(n).concat(r).concat(c):void 0}function downloadCSV(e){e.forEach(function(e){delete e.candlestick,delete e.logs,delete e.input,delete e.isError,delete e.nonce,delete e.transactionIndex,delete e.value,delete e.txreceipt_status,delete e.unixtimeSec,delete e.contractAddress}),dlbtn.classList.remove("btn-secondary"),dlbtn.classList.remove("disabled"),dlbtn.classList.add("btn-warning");var a=Object.keys(e[0]),t=a.join(","),n=e.map(function(t){return a.map(function(e){return t[e]}).join(",")}).join("\n"),r="data:text/csv;charset=utf-8,".concat(t,"\n").concat(n),c=encodeURI(r);dlbtn.href=c,dlbtn.setAttribute("download","data.csv"),dlbtn.classList.remove("disabled")}function division10p18fixed8(e){return Number((e/1e18).toFixed(8))}function hexConvert(e){return parseInt(e,16)}